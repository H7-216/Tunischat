<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H7 Social - Plateforme de Communication Moderne</title>
    <meta name="description" content="H7 Social est une plateforme de communication moderne qui connecte les utilisateurs en temps réel. Échangez, partagez et collaborez en toute simplicité.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="H7 Social - Communication en Temps Réel">
    <meta property="og:description" content="Rejoignez H7 Social pour discuter avec la communauté en temps réel, envoyer des messages privés et rester connecté avec vos amis.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary: #3B82F6;
            --secondary: #8B5CF6;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .hover-scale {
            transition: transform 0.2s ease-in-out;
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
        }
        
        .chat-message {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 60;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 16px;
            max-width: 300px;
            border-left: 4px solid #3B82F6;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.error {
            border-left-color: #EF4444;
        }
        
        .toast.success {
            border-left-color: #10B981;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .avatar-upload-container {
            position: relative;
            display: inline-block;
        }
        
        .avatar-upload-button {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
        }

        .config-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            z-index: 1000;
            max-width: 350px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Configuration Panel -->
    <div id="config-panel" class="config-panel hidden">
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-gray-900">Configuration Firebase</h3>
            <button onclick="toggleConfigPanel()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                <input type="text" id="firebase-api-key" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Votre clé API Firebase">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Database URL</label>
                <input type="text" id="firebase-db-url" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="URL de votre base de données">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Project ID</label>
                <input type="text" id="firebase-project-id" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="ID du projet">
            </div>
            <button onclick="saveFirebaseConfig()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 text-sm">
                Sauvegarder et Connecter
            </button>
            <p class="text-xs text-gray-500">Ces informations sont stockées localement dans votre navigateur</p>
        </div>
    </div>

    <!-- Settings Button -->
    <button onclick="toggleConfigPanel()" 
            class="fixed top-4 left-4 z-50 bg-white p-3 rounded-full shadow-lg border border-gray-200 hover:bg-gray-50 transition-colors">
        <i class="fas fa-cog text-gray-600"></i>
    </button>

    <!-- Application Container -->
    <div id="app" class="min-h-screen">
        <!-- Landing Page -->
        <div id="landing-page" class="min-h-screen bg-gray-50">
            <!-- Hero Section -->
            <div class="relative min-h-screen bg-cover bg-center flex items-center justify-center" 
                 style="background-image: url('https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080')">
                <div class="absolute inset-0 bg-black bg-opacity-40"></div>
                <div class="relative z-10 text-center text-white max-w-4xl px-6">
                    <div class="w-20 h-20 gradient-bg rounded-full flex items-center justify-center mx-auto mb-8">
                        <i class="fas fa-comments text-white text-3xl"></i>
                    </div>
                    <h1 class="text-5xl md:text-6xl font-bold mb-6">H7 Social</h1>
                    <p class="text-xl md:text-2xl mb-8 opacity-90">
                        La plateforme de communication moderne qui connecte les utilisateurs en temps réel
                    </p>
                    <button onclick="showAuthModal()" 
                            class="gradient-bg text-white px-8 py-4 rounded-lg text-lg font-semibold hover-scale shadow-xl">
                        Rejoindre la communauté
                    </button>
                </div>
            </div>

            <!-- Features Section -->
            <div class="py-20 bg-white">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4">Fonctionnalités</h2>
                        <p class="text-xl text-gray-600">Tout ce dont vous avez besoin pour communiquer efficacement</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="text-center p-8 rounded-xl border border-gray-200 hover:shadow-lg transition-shadow">
                            <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-users text-white text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-4">Chat Public</h3>
                            <p class="text-gray-600">Discutez avec tous les membres de la communauté en temps réel</p>
                        </div>
                        
                        <div class="text-center p-8 rounded-xl border border-gray-200 hover:shadow-lg transition-shadow">
                            <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-comment-dots text-white text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-4">Messages Privés</h3>
                            <p class="text-gray-600">Échangez en privé avec vos contacts préférés</p>
                        </div>
                        
                        <div class="text-center p-8 rounded-xl border border-gray-200 hover:shadow-lg transition-shadow">
                            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-bolt text-white text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold mb-4">Temps Réel</h3>
                            <p class="text-gray-600">Recevez et envoyez des messages instantanément</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="bg-gray-900 text-white mt-16">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Brand Section -->
                        <div class="col-span-1 lg:col-span-2">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center">
                                    <i class="fas fa-comments text-white text-xl"></i>
                                </div>
                                <h3 class="text-2xl font-bold">H7 Social</h3>
                            </div>
                            <p class="text-gray-300 max-w-md mb-6">
                                La plateforme de communication moderne qui connecte les utilisateurs en temps réel. 
                                Échangez, partagez et collaborez en toute simplicité.
                            </p>
                            <div class="flex space-x-4">
                                <a href="https://t.snapchat.com/XuhVH62f" target="_blank" rel="noopener noreferrer"
                                   class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center hover:bg-yellow-600 transition-colors">
                                    <i class="fab fa-snapchat-ghost text-white"></i>
                                </a>
                                <a href="#" class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center hover:bg-blue-700 transition-colors">
                                    <i class="fab fa-facebook-f text-white"></i>
                                </a>
                                <a href="#" class="w-10 h-10 bg-pink-600 rounded-lg flex items-center justify-center hover:bg-pink-700 transition-colors">
                                    <i class="fab fa-instagram text-white"></i>
                                </a>
                                <a href="#" class="w-10 h-10 bg-blue-400 rounded-lg flex items-center justify-center hover:bg-blue-500 transition-colors">
                                    <i class="fab fa-twitter text-white"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Quick Links -->
                        <div>
                            <h4 class="font-semibold text-lg mb-4">Liens Rapides</h4>
                            <ul class="space-y-2">
                                <li>
                                    <button onclick="showModal('about')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-info-circle mr-2"></i>À propos de nous
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('features')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-star mr-2"></i>Fonctionnalités
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('help')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-question-circle mr-2"></i>Centre d'aide
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('blog')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-blog mr-2"></i>Blog
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <!-- Legal Links -->
                        <div>
                            <h4 class="font-semibold text-lg mb-4">Légal</h4>
                            <ul class="space-y-2">
                                <li>
                                    <button onclick="showModal('privacy')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-shield-alt mr-2"></i>Confidentialité
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('terms')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-file-contract mr-2"></i>CGV
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('cookies')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-cookie-bite mr-2"></i>Cookies
                                    </button>
                                </li>
                                <li>
                                    <button onclick="showModal('contact')" 
                                            class="text-gray-300 hover:text-white transition-colors flex items-center">
                                        <i class="fas fa-envelope mr-2"></i>Nous contacter
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Bottom Bar -->
                <div class="border-t border-gray-800">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <p class="text-gray-400 text-sm">
                                © 2025 H7 Social. Tous droits réservés.
                            </p>
                            <div class="flex items-center space-x-6 mt-4 md:mt-0">
                                <span class="text-gray-400 text-sm">Développé avec ❤️ par l'équipe H7</span>
                                <div class="flex items-center space-x-2">
                                    <span id="server-status" class="w-2 h-2 bg-gray-500 rounded-full"></span>
                                    <span id="server-status-text" class="text-sm text-gray-400">Connexion en cours...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Chat Application -->
        <div id="chat-app" class="hidden min-h-screen bg-gray-50">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <!-- Logo and Brand -->
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center">
                                <i class="fas fa-comments text-white text-lg"></i>
                            </div>
                            <h1 class="text-xl font-bold text-gray-900">H7 Social</h1>
                            <div class="hidden md:flex items-center space-x-2 ml-8">
                                <span id="connection-status" class="w-3 h-3 rounded-full bg-gray-500"></span>
                                <span id="connection-text" class="text-sm text-gray-600">Connexion...</span>
                            </div>
                        </div>

                        <!-- User Profile and Controls -->
                        <div class="flex items-center space-x-4">
                            <!-- User Profile -->
                            <div class="flex items-center space-x-3">
                                <div class="avatar-upload-container">
                                    <img id="current-user-avatar" src="" alt="Avatar" 
                                         class="w-10 h-10 rounded-full object-cover border-2 border-gray-200">
                                    <button onclick="openAvatarUpload()" class="avatar-upload-button" title="Changer l'avatar">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                    <input type="file" id="avatar-upload" class="hidden" accept="image/*" onchange="handleAvatarUpload(event)">
                                </div>
                                <div class="hidden md:block">
                                    <p class="text-sm font-medium text-gray-900" id="current-username">Utilisateur</p>
                                    <p class="text-xs text-gray-500" id="user-role">Membre</p>
                                </div>
                            </div>
                            
                            <!-- Logout Button -->
                            <button onclick="logout()" 
                                    class="text-gray-500 hover:text-red-500 transition-colors">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Sidebar -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold text-lg text-gray-900">Utilisateurs Connectés</h3>
                            <button onclick="refreshUsersList()" class="text-gray-500 hover:text-blue-500 transition-colors" title="Actualiser">
                                <i class="fas fa-sync-alt text-sm"></i>
                            </button>
                        </div>
                        <div id="online-users" class="space-y-3">
                            <!-- Les utilisateurs connectés seront affichés ici -->
                        </div>
                        
                        <div id="offline-users-section" class="mt-6 pt-4 border-t border-gray-200">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Utilisateurs Hors Ligne</h4>
                            <div id="offline-users" class="space-y-2">
                                <!-- Les utilisateurs hors ligne seront affichés ici -->
                            </div>
                        </div>
                        
                        <!-- Quick Stats -->
                        <div class="mt-6 gradient-bg rounded-xl p-6 text-white">
                            <h4 class="font-semibold mb-3">Statistiques</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span>Utilisateurs actifs:</span>
                                    <span id="active-users-count">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Messages aujourd'hui:</span>
                                    <span id="daily-messages">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Fichiers partagés:</span>
                                    <span id="shared-files">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Area -->
                    <div class="lg:col-span-3 space-y-6">
                        <!-- Chat Tabs -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <div class="flex border-b border-gray-200 mb-6">
                                <button onclick="switchChat('public')" 
                                        class="chat-tab px-6 py-3 border-b-2 border-blue-500 text-blue-600 font-medium">
                                    Chat Public
                                </button>
                                <button onclick="switchChat('private')" 
                                        class="chat-tab px-6 py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                                    Messages Privés
                                </button>
                            </div>

                            <!-- Public Chat -->
                            <div id="public-chat" class="space-y-6">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-semibold text-gray-800">Discussion Publique</h3>
                                    <!-- Bouton admin H7 pour vider tout le chat -->
                                    <button id="admin-clear-chat" onclick="adminClearAllMessages()" 
                                            class="bg-red-600 text-white px-3 py-1.5 rounded-lg hover:bg-red-700 text-sm hidden" 
                                            title="Supprimer tous les messages (Admin H7 uniquement)">
                                        <i class="fas fa-trash-alt mr-1"></i> Vider le chat
                                    </button>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4 h-96 overflow-y-auto" id="chat-messages">
                                    <div class="text-center text-gray-500 py-8">
                                        <i class="fas fa-comments text-4xl mb-4 opacity-50"></i>
                                        <p>Aucun message pour le moment. Commencez la conversation !</p>
                                    </div>
                                </div>
                                
                                <!-- Message Input -->
                                <div class="border-t border-gray-200 pt-6">
                                    <div id="attachments-preview" class="hidden mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-medium text-blue-800">Fichiers sélectionnés:</span>
                                            <button onclick="clearAttachments()" class="text-blue-600 hover:text-blue-800">
                                                <i class="fas fa-times text-sm"></i>
                                            </button>
                                        </div>
                                        <div id="attachments-list" class="space-y-2"></div>
                                    </div>
                                    
                                    <div class="flex space-x-4">
                                        <div class="flex-1">
                                            <textarea id="message-input" placeholder="Tapez votre message..." 
                                                      class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                                      rows="2" onkeypress="handleKeyPress(event)"></textarea>
                                        </div>
                                        <div class="flex flex-col space-y-2">
                                            <input id="file-input" type="file" class="hidden" multiple 
                                                   accept="image/*,video/*,.pdf,.doc,.docx,.txt" onchange="handleFileSelect(event)">
                                            <button onclick="document.getElementById('file-input').click()" 
                                                    class="p-3 text-gray-500 hover:text-blue-500 transition-colors" title="Joindre un fichier">
                                                <i id="file-icon" class="fas fa-paperclip text-lg"></i>
                                            </button>
                                            <button onclick="sendMessage()" 
                                                    class="gradient-bg text-white p-3 rounded-lg hover-scale" title="Envoyer le message">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Private Chat -->
                            <div id="private-chat" class="hidden">
                                <div class="bg-gray-50 rounded-lg p-4 h-96 overflow-y-auto flex items-center justify-center">
                                    <div class="text-center text-gray-500">
                                        <i class="fas fa-user-friends text-4xl mb-4 opacity-50"></i>
                                        <p>Sélectionnez un utilisateur pour commencer une conversation privée</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-bg rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Rejoindre H7 Social</h2>
                <p class="text-gray-600">Connectez-vous ou créez un compte pour commencer à discuter</p>
            </div>

            <div id="auth-tabs" class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button onclick="switchAuthTab('login')" 
                        class="auth-tab flex-1 py-2 px-4 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm">
                    Connexion
                </button>
                <button onclick="switchAuthTab('register')" 
                        class="auth-tab flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700">
                    Inscription
                </button>
            </div>

            <form id="auth-form" onsubmit="handleAuth(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom d'utilisateur</label>
                        <input type="text" id="auth-username" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Votre nom d'utilisateur">
                    </div>
                    
                    <div id="password-field" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="auth-password"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Votre mot de passe">
                    </div>
                    
                    <div id="avatar-selection" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Photo de profil (optionnelle)</label>
                        <div class="flex justify-center mb-4">
                            <div class="avatar-upload-container">
                                <img id="preview-avatar" src="" alt="Aperçu" 
                                     class="w-20 h-20 rounded-full object-cover border-4 border-gray-200 bg-gray-100">
                                <button type="button" onclick="openRegistrationAvatarUpload()" class="avatar-upload-button" title="Choisir une photo">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <input type="file" id="registration-avatar-upload" class="hidden" accept="image/*" onchange="handleRegistrationAvatarUpload(event)">
                    </div>

                    <button type="submit" id="auth-submit"
                            class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover-scale">
                        Se connecter
                    </button>
                </div>
            </form>

            <div class="mt-6">
                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500">Ou connectez-vous avec</span>
                    </div>
                </div>
                
                <button onclick="loginWithGoogle()" disabled
                        class="mt-4 w-full border border-gray-300 bg-white text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-50 flex items-center justify-center space-x-2 opacity-50 cursor-not-allowed">
                    <i class="fab fa-google text-red-500"></i>
                    <span>Google (Configurez Firebase d'abord)</span>
                </button>
            </div>

            <button onclick="closeAuthModal()" 
                    class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    </div>

    <!-- General Modal -->
    <div id="general-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-gray-900"></h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="modal-content" class="text-gray-700"></div>
        </div>
    </div>

    <script type="module">
        // Configuration Firebase (cachée par défaut pour la sécurité)
        let firebaseConfig = null;
        let firebaseApp = null;
        let database = null;
        let auth = null;

        // Variables globales
        let currentUser = null;
        let messages = [];
        let allUsers = [];
        let currentView = 'public';
        let attachments = [];
        let isLogin = true;

        // État de l'application
        let isFirebaseConnected = false;
        let connectionAttempts = 0;
        const MAX_CONNECTION_ATTEMPTS = 3;

        // Initialisation de l'application
        window.addEventListener('DOMContentLoaded', function() {
            loadFirebaseConfig();
            initializeApp();
        });

        // Gestion de la configuration Firebase
        window.toggleConfigPanel = function() {
            const panel = document.getElementById('config-panel');
            panel.classList.toggle('hidden');
        };

        window.saveFirebaseConfig = function() {
            const apiKey = document.getElementById('firebase-api-key').value.trim();
            const dbUrl = document.getElementById('firebase-db-url').value.trim();
            const projectId = document.getElementById('firebase-project-id').value.trim();

            if (!apiKey || !dbUrl || !projectId) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            const config = {
                apiKey: apiKey,
                authDomain: projectId + '.firebaseapp.com',
                databaseURL: dbUrl,
                projectId: projectId,
                storageBucket: projectId + '.appspot.com',
                messagingSenderId: '767585260701',
                appId: '1:767585260701:web:9159e8293d385415f87074'
            };

            // Sauvegarder dans localStorage
            localStorage.setItem('h7_firebase_config', JSON.stringify(config));
            firebaseConfig = config;

            // Initialiser Firebase
            initializeFirebase();
            toggleConfigPanel();
        };

        function loadFirebaseConfig() {
            const savedConfig = localStorage.getItem('h7_firebase_config');
            if (savedConfig) {
                firebaseConfig = JSON.parse(savedConfig);
                // Pré-remplir les champs
                if (firebaseConfig.apiKey) {
                    document.getElementById('firebase-api-key').value = firebaseConfig.apiKey;
                    document.getElementById('firebase-db-url').value = firebaseConfig.databaseURL;
                    document.getElementById('firebase-project-id').value = firebaseConfig.projectId;
                }
            }
        }

        function initializeApp() {
            updateConnectionStatus('offline', 'Hors ligne');
            
            if (firebaseConfig) {
                initializeFirebase();
            } else {
                showToast('Configuration Firebase requise. Cliquez sur l\'icône de paramètres.', 'error');
                setTimeout(() => {
                    document.getElementById('config-panel').classList.remove('hidden');
                }, 2000);
            }

            // Initialiser avec une liste vide - seulement les vrais utilisateurs Firebase
            allUsers = [];
            updateUsersList();
        }

        async function initializeFirebase() {
            if (!firebaseConfig) return;

            try {
                updateConnectionStatus('connecting', 'Connexion...');
                
                // Charger Firebase dynamiquement
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getDatabase, ref, push, onValue, off, set } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');
                const { getAuth, GoogleAuthProvider } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');

                firebaseApp = initializeApp(firebaseConfig);
                database = getDatabase(firebaseApp);
                auth = getAuth(firebaseApp);

                // Stocker les références globalement
                window.database = database;
                window.auth = auth;
                window.firebaseRefs = { ref, push, onValue, off, set };
                window.googleProvider = new GoogleAuthProvider();

                // Tester la connexion
                const testRef = ref(database, '.info/connected');
                onValue(testRef, (snapshot) => {
                    if (snapshot.val() === true) {
                        isFirebaseConnected = true;
                        updateConnectionStatus('online', 'Connecté à Firebase');
                        loadUsersFromFirebase();
                        connectionAttempts = 0;
                    } else {
                        isFirebaseConnected = false;
                        updateConnectionStatus('offline', 'Connexion Firebase perdue');
                    }
                });

                // Activer le bouton Google
                const googleBtn = document.querySelector('button[onclick="loginWithGoogle()"]');
                if (googleBtn) {
                    googleBtn.disabled = false;
                    googleBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    googleBtn.innerHTML = '<i class="fab fa-google text-red-500"></i><span>Google</span>';
                }

            } catch (error) {
                console.error('Erreur Firebase:', error);
                connectionAttempts++;
                
                if (connectionAttempts < MAX_CONNECTION_ATTEMPTS) {
                    showToast(`Tentative de reconnexion ${connectionAttempts}/${MAX_CONNECTION_ATTEMPTS}...`, 'error');
                    setTimeout(() => initializeFirebase(), 2000);
                } else {
                    updateConnectionStatus('error', 'Erreur de configuration Firebase');
                    showToast('Vérifiez votre configuration Firebase', 'error');
                }
            }
        }

        function loadUsersFromFirebase() {
            if (!database) return;

            const usersRef = window.firebaseRefs.ref(database, 'users');
            window.firebaseRefs.onValue(usersRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Afficher uniquement les vrais utilisateurs de Firebase
                    allUsers = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                } else {
                    // Aucun utilisateur dans Firebase = liste vide
                    allUsers = [];
                }
                updateUsersList();
            });
        }

        function updateConnectionStatus(status, text) {
            const statusElement = document.getElementById('connection-status');
            const textElement = document.getElementById('connection-text');
            const serverStatus = document.getElementById('server-status');
            const serverStatusText = document.getElementById('server-status-text');

            const statusConfig = {
                offline: { color: 'bg-gray-500', text: text || 'Hors ligne' },
                connecting: { color: 'bg-yellow-500', text: text || 'Connexion...' },
                online: { color: 'bg-green-500', text: text || 'En ligne' },
                demo: { color: 'bg-blue-500', text: text || 'Mode démo' },
                error: { color: 'bg-red-500', text: text || 'Erreur' }
            };

            const config = statusConfig[status] || statusConfig.offline;
            
            if (statusElement) {
                statusElement.className = `w-3 h-3 rounded-full ${config.color}`;
            }
            if (textElement) {
                textElement.textContent = config.text;
            }
            if (serverStatus) {
                serverStatus.className = `w-2 h-2 rounded-full ${config.color}`;
            }
            if (serverStatusText) {
                serverStatusText.textContent = config.text;
            }
        }

        // Function to get default avatar for users
        function getDefaultAvatar(username) {
            if (username.toLowerCase() === 'h7') {
                return 'https://printedman.com/cdn/shop/files/CR7Red.jpg?v=1694289458&width=1946';
            }
            // Generate a consistent avatar based on username
            const seed = username.toLowerCase();
            return `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}&size=150`;
        }

        // Gestion de l'authentification
        window.showAuthModal = function() {
            document.getElementById('auth-modal').classList.remove('hidden');
        };

        window.closeAuthModal = function() {
            document.getElementById('auth-modal').classList.add('hidden');
        };

        window.switchAuthTab = function(tab) {
            const tabs = document.querySelectorAll('.auth-tab');
            const loginTab = tabs[0];
            const registerTab = tabs[1];
            const passwordField = document.getElementById('password-field');
            const avatarSelection = document.getElementById('avatar-selection');
            const submitButton = document.getElementById('auth-submit');

            tabs.forEach(t => {
                t.classList.remove('bg-white', 'text-gray-900', 'shadow-sm');
                t.classList.add('text-gray-500', 'hover:text-gray-700');
            });

            if (tab === 'login') {
                isLogin = true;
                loginTab.classList.add('bg-white', 'text-gray-900', 'shadow-sm');
                loginTab.classList.remove('text-gray-500', 'hover:text-gray-700');
                passwordField.classList.add('hidden');
                avatarSelection.classList.add('hidden');
                submitButton.textContent = 'Se connecter';
            } else {
                isLogin = false;
                registerTab.classList.add('bg-white', 'text-gray-900', 'shadow-sm');
                registerTab.classList.remove('text-gray-500', 'hover:text-gray-700');
                passwordField.classList.remove('hidden');
                avatarSelection.classList.remove('hidden');
                submitButton.textContent = 'S\'inscrire';
                
                // Définir un avatar par défaut pour l'aperçu
                const previewAvatar = document.getElementById('preview-avatar');
                previewAvatar.src = getDefaultAvatar('default');
            }
        };

        window.handleAuth = function(event) {
            event.preventDefault();
            
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;

            if (!username) {
                showToast('Le nom d\'utilisateur est requis', 'error');
                return;
            }

            if (!isLogin && !password) {
                showToast('Le mot de passe est requis pour l\'inscription', 'error');
                return;
            }

            // Créer l'utilisateur
            const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const previewAvatar = document.getElementById('preview-avatar');
            
            currentUser = {
                id: userId,
                username: username,
                isAdmin: username.toLowerCase() === 'h7' || username.toLowerCase() === 'admin',
                profileImage: previewAvatar.src || getDefaultAvatar(username)
            };

            // Mettre à jour l'interface utilisateur
            document.getElementById('current-username').textContent = currentUser.username;
            document.getElementById('user-role').textContent = currentUser.isAdmin ? 'Administrateur' : 'Membre';
            document.getElementById('current-user-avatar').src = currentUser.profileImage;

            // Ajouter l'utilisateur à la liste si Firebase est connecté
            if (isFirebaseConnected && database) {
                const userRef = window.firebaseRefs.ref(database, `users/${userId}`);
                const userData = {
                    username: currentUser.username,
                    isOnline: true,
                    isAdmin: currentUser.isAdmin,
                    profileImage: currentUser.profileImage,
                    lastSeen: new Date().toISOString()
                };
                
                window.firebaseRefs.set(userRef, userData);
            } else {
                // Mode local/démo
                const existingUserIndex = allUsers.findIndex(u => u.id === userId);
                if (existingUserIndex >= 0) {
                    allUsers[existingUserIndex] = { ...currentUser, isOnline: true };
                } else {
                    allUsers.push({ ...currentUser, isOnline: true });
                }
                updateUsersList();
            }

            // Fermer la modal et afficher le chat
            closeAuthModal();
            showChatApp();
            updateAdminControls(); // Afficher les contrôles admin si c'est H7
            
            showToast(`Bienvenue ${currentUser.username}!`, 'success');
        };

        // Gestion de l'upload d'avatar
        window.openAvatarUpload = function() {
            document.getElementById('avatar-upload').click();
        };

        window.openRegistrationAvatarUpload = function() {
            document.getElementById('registration-avatar-upload').click();
        };

        window.handleAvatarUpload = function(event) {
            handleAvatarFile(event, 'current-user-avatar', true);
        };

        window.handleRegistrationAvatarUpload = function(event) {
            handleAvatarFile(event, 'preview-avatar', false);
        };

        function handleAvatarFile(event, targetId, isCurrentUser) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('Veuillez sélectionner une image valide', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB
                showToast('L\'image doit faire moins de 5MB', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                document.getElementById(targetId).src = imageUrl;
                
                if (isCurrentUser && currentUser) {
                    currentUser.profileImage = imageUrl;
                    
                    // Mettre à jour dans Firebase si connecté
                    if (isFirebaseConnected && database) {
                        const userRef = window.firebaseRefs.ref(database, `users/${currentUser.id}`);
                        window.firebaseRefs.set(userRef, {
                            username: currentUser.username,
                            isOnline: true,
                            isAdmin: currentUser.isAdmin,
                            profileImage: imageUrl,
                            lastSeen: new Date().toISOString()
                        });
                    }
                    
                    showToast('Avatar mis à jour avec succès', 'success');
                }
            };
            reader.readAsDataURL(file);
        };

        function showChatApp() {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('chat-app').classList.remove('hidden');
            
            if (isFirebaseConnected) {
                initializeFirebaseChat();
            }
        }

        function initializeFirebaseChat() {
            if (!database || !currentUser) return;

            const messagesRef = window.firebaseRefs.ref(database, 'messages');
            
            // Écouter les nouveaux messages
            window.firebaseRefs.onValue(messagesRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    messages = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    })).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                } else {
                    messages = [];
                }
                updateMessages();
            });

            // Marquer l'utilisateur comme en ligne
            const currentUserRef = window.firebaseRefs.ref(database, `users/${currentUser.id}`);
            window.firebaseRefs.set(currentUserRef, {
                username: currentUser.username,
                isOnline: true,
                isAdmin: currentUser.isAdmin,
                profileImage: currentUser.profileImage,
                lastSeen: new Date().toISOString()
            });

            // Gérer la déconnexion
            window.addEventListener('beforeunload', () => {
                if (database && currentUser) {
                    window.firebaseRefs.set(currentUserRef, {
                        username: currentUser.username,
                        isOnline: false,
                        isAdmin: currentUser.isAdmin,
                        profileImage: currentUser.profileImage,
                        lastSeen: new Date().toISOString()
                    });
                }
            });
        }

        // Gestion des messages
        window.handleKeyPress = function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        };

        window.handlePrivateKeyPress = function(event, userId) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendPrivateMessage(userId);
            }
        };

        window.sendPrivateMessage = function(userId) {
            const messageInput = document.getElementById(`private-message-input-${userId}`);
            const messageText = messageInput.value.trim();
            
            if (!messageText) return;
            if (!currentUser) {
                showToast('Vous devez être connecté pour envoyer un message', 'error');
                return;
            }

            const targetUser = allUsers.find(u => u.id === userId);
            if (!targetUser) {
                showToast('Utilisateur introuvable', 'error');
                return;
            }

            const message = {
                id: 'private_msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                text: messageText,
                from: currentUser.username,
                fromId: currentUser.id,
                to: targetUser.username,
                toId: userId,
                timestamp: new Date().toISOString(),
                isPrivate: true,
                profileImage: currentUser.profileImage
            };

            // Afficher le message dans l'interface
            const messagesContainer = document.getElementById(`private-messages-${userId}`);
            const messageTime = new Date(message.timestamp);
            const timeString = messageTime.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            // Remplacer le message d'accueil s'il existe
            if (messagesContainer.innerHTML.includes('Début de votre conversation')) {
                messagesContainer.innerHTML = '';
            }

            messagesContainer.innerHTML += `
                <div class="chat-message flex justify-end mb-4">
                    <div class="bg-blue-500 text-white px-4 py-2 rounded-lg max-w-xs">
                        <div class="text-sm">${message.text}</div>
                        <div class="text-xs opacity-75 mt-1">${timeString}</div>
                    </div>
                </div>
            `;

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            messageInput.value = '';
            
            // En réalité, ici vous devriez envoyer le message via Firebase
            if (isFirebaseConnected && database) {
                const privateMessagesRef = window.firebaseRefs.ref(database, `privateMessages/${currentUser.id}_${userId}`);
                window.firebaseRefs.push(privateMessagesRef, message);
            }

            showToast(`Message envoyé à ${targetUser.username}`, 'success');
        };

        window.sendMessage = function() {
            const messageInput = document.getElementById('message-input');
            const messageText = messageInput.value.trim();

            if (!messageText && attachments.length === 0) return;
            if (!currentUser) {
                showToast('Vous devez être connecté pour envoyer un message', 'error');
                return;
            }

            const message = {
                id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                text: messageText,
                username: currentUser.username,
                userId: currentUser.id,
                timestamp: new Date().toISOString(),
                isAdmin: currentUser.isAdmin,
                profileImage: currentUser.profileImage,
                attachments: attachments.length > 0 ? [...attachments] : null
            };

            if (isFirebaseConnected && database) {
                // Envoyer via Firebase
                const messagesRef = window.firebaseRefs.ref(database, 'messages');
                window.firebaseRefs.push(messagesRef, message);
            } else {
                // Mode local
                messages.push(message);
                updateMessages();
            }

            // Nettoyer le formulaire
            messageInput.value = '';
            clearAttachments();
            messageInput.focus();
        };

        function updateMessages() {
            const container = document.getElementById('chat-messages');
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-comments text-4xl mb-4 opacity-50"></i>
                        <p>Aucun message pour le moment. Commencez la conversation !</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = messages.map(msg => {
                const messageTime = new Date(msg.timestamp);
                const timeString = messageTime.toLocaleTimeString('fr-FR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                const attachmentsHtml = msg.attachments ? 
                    msg.attachments.map(att => `
                        <div class="mt-2 p-2 bg-blue-50 rounded border border-blue-200 text-sm flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-paperclip mr-2"></i>
                                <span class="text-blue-700">${att.name}</span>
                                <span class="text-gray-500 ml-2">(${formatFileSize(att.size)})</span>
                            </div>
                            <button onclick="downloadAttachment('${att.url}', '${att.name}')" 
                                    class="text-blue-600 hover:text-blue-800 ml-2" title="Télécharger">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    `).join('') : '';

                const isOwner = currentUser && msg.userId === currentUser.id;
                const canEdit = isOwner;
                const canDelete = currentUser && currentUser.isAdmin && currentUser.username === 'H7';

                const actionsHtml = (canEdit || canDelete) ? `
                    <div class="opacity-0 group-hover:opacity-100 transition-opacity flex space-x-2 ml-2">
                        ${canEdit ? `<button onclick="editMessage('${msg.id}')" class="text-gray-400 hover:text-blue-500" title="Éditer">
                            <i class="fas fa-edit text-sm"></i>
                        </button>` : ''}
                        ${canDelete ? `<button onclick="deleteMessage('${msg.id}')" class="text-red-500 hover:text-red-700" title="Supprimer (Admin uniquement)">
                            <i class="fas fa-trash text-sm"></i>
                        </button>` : ''}
                    </div>
                ` : '';

                return `
                    <div class="chat-message group flex space-x-3 mb-4 hover:bg-gray-50 p-2 rounded-lg transition-colors">
                        <img src="${msg.profileImage || getDefaultAvatar(msg.username)}" 
                             alt="${msg.username}" 
                             class="w-10 h-10 rounded-full object-cover ${msg.isAdmin ? 'border-2 border-yellow-400' : ''}"
                             onerror="this.src='${getDefaultAvatar(msg.username)}'">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-medium text-gray-900">${msg.username}</span>
                                ${msg.isAdmin ? '<i class="fas fa-crown text-yellow-500 text-sm" title="Administrateur"></i>' : ''}
                                <span class="text-xs text-gray-500">${timeString}</span>
                                ${actionsHtml}
                            </div>
                            <div class="text-gray-700 break-words" id="message-content-${msg.id}">${msg.text}</div>
                            ${attachmentsHtml}
                        </div>
                    </div>
                `;
            }).join('');

            container.scrollTop = container.scrollHeight;
        }

        // Gestion des utilisateurs
        function updateUsersList() {
            const onlineContainer = document.getElementById('online-users');
            const offlineContainer = document.getElementById('offline-users');
            const offlineSection = document.getElementById('offline-users-section');
            const activeCount = document.getElementById('active-users-count');

            const onlineUsers = allUsers.filter(u => u.isOnline);
            const offlineUsers = allUsers.filter(u => !u.isOnline);

            // Mettre à jour les utilisateurs en ligne
            if (onlineUsers.length > 0) {
                onlineContainer.innerHTML = onlineUsers.map(user => {
                    const avatarUrl = user.profileImage || getDefaultAvatar(user.username);
                    return `
                        <div onclick="selectUser('${user.id}')" 
                             class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                            <img src="${avatarUrl}" alt="Profil ${user.username}" 
                                 class="w-10 h-10 rounded-full object-cover ${user.isAdmin ? 'border-2 border-yellow-400' : ''}"
                                 onerror="this.src='${getDefaultAvatar(user.username)}'">
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate">
                                    ${user.username} ${user.isAdmin ? '(Admin) 👑' : ''}
                                </p>
                                <div class="flex items-center space-x-1">
                                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                    <span class="text-xs text-green-600">En ligne</span>
                                </div>
                            </div>
                            ${user.isAdmin ? '<i class="fas fa-crown text-yellow-500"></i>' : ''}
                        </div>
                    `;
                }).join('');
            } else {
                // Message différent selon l'état de Firebase
                if (!isFirebaseConnected) {
                    onlineContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-6">
                            <i class="fas fa-cog text-3xl mb-3 opacity-50"></i>
                            <p class="text-sm font-medium mb-2">Firebase non configuré</p>
                            <p class="text-xs">Cliquez sur l'icône paramètres pour configurer</p>
                            <button onclick="toggleConfigPanel()" class="mt-3 px-4 py-2 bg-blue-500 text-white text-xs rounded-lg hover:bg-blue-600">
                                Configurer maintenant
                            </button>
                        </div>
                    `;
                } else {
                    onlineContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            <i class="fas fa-user-friends text-2xl mb-2 opacity-50"></i>
                            <p class="text-sm">Aucun utilisateur connecté</p>
                            <p class="text-xs mt-1">Les utilisateurs apparaîtront ici une fois connectés</p>
                        </div>
                    `;
                }
            }

            // Cacher complètement la section des utilisateurs hors ligne
            // Les utilisateurs déconnectés ne doivent plus apparaître dans la liste
            offlineSection.classList.add('hidden');

            // Mettre à jour les statistiques
            activeCount.textContent = onlineUsers.length;
            document.getElementById('daily-messages').textContent = messages.length;
            document.getElementById('shared-files').textContent = messages.filter(m => m.attachments && m.attachments.length > 0).length;
        }

        window.refreshUsersList = function() {
            if (isFirebaseConnected) {
                loadUsersFromFirebase();
                showToast('Liste des utilisateurs actualisée', 'success');
            } else {
                showToast('Veuillez configurer Firebase pour voir les utilisateurs réels', 'error');
            }
        };

        window.selectUser = function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                // Basculer vers l'onglet messages privés
                switchChat('private');
                
                // Afficher l'interface de chat privé avec cet utilisateur
                const privateChat = document.getElementById('private-chat');
                const avatarUrl = user.profileImage || getDefaultAvatar(user.username);
                
                privateChat.innerHTML = `
                    <div class="flex items-center space-x-3 mb-4 p-4 bg-gray-50 rounded-lg">
                        <img src="${avatarUrl}" alt="${user.username}" 
                             class="w-12 h-12 rounded-full object-cover ${user.isAdmin ? 'border-2 border-yellow-400' : ''}"
                             onerror="this.src='${getDefaultAvatar(user.username)}'">
                        <div>
                            <h3 class="font-semibold text-gray-900">${user.username} ${user.isAdmin ? '👑' : ''}</h3>
                            <p class="text-sm text-gray-500">${user.isOnline ? 'En ligne' : 'Hors ligne'}</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4 h-80 overflow-y-auto mb-4" id="private-messages-${userId}">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-comment-dots text-4xl mb-4 opacity-50"></i>
                            <p>Début de votre conversation avec ${user.username}</p>
                            <p class="text-sm mt-2">Les messages privés apparaîtront ici</p>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <textarea id="private-message-input-${userId}" placeholder="Message privé à ${user.username}..." 
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                          rows="2" onkeypress="handlePrivateKeyPress(event, '${userId}')"></textarea>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="sendPrivateMessage('${userId}')" 
                                        class="gradient-bg text-white p-3 rounded-lg hover-scale" title="Envoyer le message privé">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                showToast(`Conversation privée avec ${user.username} ouverte`, 'success');
            }
        };

        // Gestion des fichiers
        window.handleFileSelect = function(event) {
            const files = Array.from(event.target.files || []);
            if (files.length === 0) return;

            const fileIcon = document.getElementById('file-icon');
            fileIcon.className = 'fas fa-spinner fa-spin text-lg';

            files.forEach(file => {
                // Simuler l'upload de fichier
                const fileData = {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    url: URL.createObjectURL(file)
                };
                attachments.push(fileData);
            });

            updateAttachmentsPreview();
            showToast(`${files.length} fichier${files.length > 1 ? 's' : ''} ajouté${files.length > 1 ? 's' : ''}`, 'success');

            setTimeout(() => {
                fileIcon.className = 'fas fa-paperclip text-lg';
            }, 1000);
        };

        function updateAttachmentsPreview() {
            const preview = document.getElementById('attachments-preview');
            const list = document.getElementById('attachments-list');

            if (attachments.length === 0) {
                preview.classList.add('hidden');
                return;
            }

            preview.classList.remove('hidden');
            list.innerHTML = attachments.map((file, index) => `
                <div class="flex items-center justify-between bg-white p-2 rounded border">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-file text-blue-500"></i>
                        <span class="text-sm text-gray-700">${file.name}</span>
                        <span class="text-xs text-gray-500">(${formatFileSize(file.size)})</span>
                    </div>
                    <button onclick="removeAttachment(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `).join('');
        }

        window.removeAttachment = function(index) {
            attachments.splice(index, 1);
            updateAttachmentsPreview();
        };

        window.clearAttachments = function() {
            attachments = [];
            updateAttachmentsPreview();
        };

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Gestion des onglets de chat
        window.switchChat = function(type) {
            const tabs = document.querySelectorAll('.chat-tab');
            const publicChat = document.getElementById('public-chat');
            const privateChat = document.getElementById('private-chat');

            tabs.forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
            });

            if (type === 'public') {
                tabs[0].classList.add('border-blue-500', 'text-blue-600');
                tabs[0].classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                publicChat.classList.remove('hidden');
                privateChat.classList.add('hidden');
                currentView = 'public';
            } else {
                tabs[1].classList.add('border-blue-500', 'text-blue-600');
                tabs[1].classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                publicChat.classList.add('hidden');
                privateChat.classList.remove('hidden');
                currentView = 'private';
            }
        };

        // Gestion de la déconnexion
        window.logout = function() {
            if (currentUser && isFirebaseConnected && database) {
                const userRef = window.firebaseRefs.ref(database, `users/${currentUser.id}`);
                window.firebaseRefs.set(userRef, {
                    username: currentUser.username,
                    isOnline: false,
                    isAdmin: currentUser.isAdmin,
                    profileImage: currentUser.profileImage,
                    lastSeen: new Date().toISOString()
                });
            }

            currentUser = null;
            messages = [];
            attachments = [];
            
            document.getElementById('chat-app').classList.add('hidden');
            document.getElementById('landing-page').classList.remove('hidden');
            
            showToast('Déconnexion réussie', 'success');
        };

        // Authentification Google
        window.loginWithGoogle = function() {
            if (!isFirebaseConnected || !auth) {
                showToast('Firebase n\'est pas configuré', 'error');
                return;
            }
            
            showToast('Connexion Google (à implémenter)', 'info');
        };

        // Gestion des modales
        window.showModal = function(type) {
            const modal = document.getElementById('general-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');

            const modals = {
                about: {
                    title: 'À propos de H7 Social',
                    content: `
                        <div class="space-y-6">
                            <p class="text-gray-700 leading-relaxed">
                                H7 Social est une plateforme de communication moderne développée avec les dernières technologies web. 
                                Notre mission est de connecter les utilisateurs du monde entier grâce à une interface intuitive et des fonctionnalités innovantes.
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="font-semibold text-lg mb-3">Notre Vision</h3>
                                    <p class="text-gray-600">Créer un espace numérique où chacun peut s'exprimer librement et se connecter avec des personnes partageant les mêmes intérêts.</p>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-lg mb-3">Notre Mission</h3>
                                    <p class="text-gray-600">Faciliter la communication en temps réel avec des outils simples, sécurisés et accessibles à tous.</p>
                                </div>
                            </div>
                        </div>
                    `
                },
                features: {
                    title: 'Fonctionnalités',
                    content: `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h3 class="font-semibold text-lg">Communication</h3>
                                <ul class="space-y-2">
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Chat public en temps réel</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Messages privés</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Partage de fichiers</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Émojis et réactions</li>
                                </ul>
                            </div>
                            <div class="space-y-4">
                                <h3 class="font-semibold text-lg">Sécurité</h3>
                                <ul class="space-y-2">
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Connexion sécurisée</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Modération automatique</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Contrôle de confidentialité</li>
                                    <li class="flex items-center"><i class="fas check text-green-500 mr-2"></i> Backup automatique</li>
                                </ul>
                            </div>
                        </div>
                    `
                },
                help: {
                    title: 'Centre d\'aide',
                    content: `
                        <div class="space-y-6">
                            <div>
                                <h3 class="font-semibold text-lg mb-3">Questions Fréquentes</h3>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h4 class="font-medium">Comment configurer Firebase ?</h4>
                                        <p class="text-gray-600 text-sm mt-1">Cliquez sur l'icône de paramètres en haut à gauche et entrez vos informations Firebase.</p>
                                    </div>
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h4 class="font-medium">Comment changer mon avatar ?</h4>
                                        <p class="text-gray-600 text-sm mt-1">Cliquez sur l'icône de caméra sur votre avatar pour télécharger une nouvelle photo.</p>
                                    </div>
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h4 class="font-medium">Comment envoyer un fichier ?</h4>
                                        <p class="text-gray-600 text-sm mt-1">Cliquez sur l'icône de trombone à côté du champ de message.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                },
                blog: {
                    title: 'Blog',
                    content: `
                        <div class="space-y-6">
                            <article class="border-l-4 border-blue-500 pl-6">
                                <h3 class="font-semibold text-lg">Nouvelles Fonctionnalités 2025</h3>
                                <p class="text-sm text-gray-500 mb-2">15 Janvier 2025</p>
                                <p class="text-gray-700">Découvrez les dernières améliorations apportées à H7 Social, incluant les appels vidéo, les groupes privés et bien plus encore...</p>
                            </article>
                            <article class="border-l-4 border-green-500 pl-6">
                                <h3 class="font-semibold text-lg">Guide de Configuration Firebase</h3>
                                <p class="text-sm text-gray-500 mb-2">10 Janvier 2025</p>
                                <p class="text-gray-700">Un tutoriel complet pour configurer votre propre instance Firebase et héberger H7 Social...</p>
                            </article>
                        </div>
                    `
                },
                privacy: {
                    title: 'Politique de Confidentialité',
                    content: `
                        <div class="space-y-4 text-sm">
                            <p>Dernière mise à jour : Janvier 2025</p>
                            <h3 class="font-semibold">Collecte des données</h3>
                            <p>Nous collectons uniquement les informations nécessaires au fonctionnement du service : nom d'utilisateur, messages et fichiers partagés.</p>
                            <h3 class="font-semibold">Utilisation des données</h3>
                            <p>Vos données sont utilisées exclusivement pour fournir et améliorer nos services de communication.</p>
                            <h3 class="font-semibold">Partage des données</h3>
                            <p>Nous ne partageons vos données avec aucun tiers sans votre consentement explicite.</p>
                        </div>
                    `
                },
                terms: {
                    title: 'Conditions Générales de Vente',
                    content: `
                        <div class="space-y-4 text-sm">
                            <p>Dernière mise à jour : Janvier 2025</p>
                            <h3 class="font-semibold">Utilisation du service</h3>
                            <p>L'utilisation de H7 Social est soumise au respect des présentes conditions et de notre politique de confidentialité.</p>
                            <h3 class="font-semibold">Responsabilités</h3>
                            <p>Les utilisateurs sont responsables du contenu qu'ils partagent et s'engagent à respecter les autres membres de la communauté.</p>
                            <h3 class="font-semibold">Modifications</h3>
                            <p>Nous nous réservons le droit de modifier ces conditions à tout moment avec un préavis de 30 jours.</p>
                        </div>
                    `
                },
                cookies: {
                    title: 'Politique des Cookies',
                    content: `
                        <div class="space-y-4 text-sm">
                            <p>Dernière mise à jour : Janvier 2025</p>
                            <h3 class="font-semibold">Types de cookies</h3>
                            <p>Nous utilisons des cookies de session pour maintenir votre connexion et des cookies de préférences pour vos paramètres.</p>
                            <h3 class="font-semibold">Gestion des cookies</h3>
                            <p>Vous pouvez désactiver les cookies dans votre navigateur, mais cela peut affecter certaines fonctionnalités.</p>
                            <h3 class="font-semibold">Cookies tiers</h3>
                            <p>Firebase peut utiliser ses propres cookies pour l'authentification et le stockage des données.</p>
                        </div>
                    `
                },
                contact: {
                    title: 'Nous Contacter',
                    content: `
                        <div class="space-y-6">
                            <!-- Formulaire de contact -->
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h3 class="font-semibold text-lg mb-4">Envoyez-nous un message</h3>
                                <form onsubmit="handleContactForm(event)" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                                            <input type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Votre nom">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                            <input type="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="votre@email.com">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Sujet</label>
                                        <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Choisissez un sujet</option>
                                            <option value="support">Support technique</option>
                                            <option value="bug">Signaler un bug</option>
                                            <option value="feature">Demande de fonctionnalité</option>
                                            <option value="partnership">Partenariat</option>
                                            <option value="other">Autre</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                                        <textarea required rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Décrivez votre demande..."></textarea>
                                    </div>
                                    <button type="submit" class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover-scale">
                                        Envoyer le message
                                    </button>
                                </form>
                            </div>

                            <!-- Informations de contact -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-xl p-6 border border-gray-200">
                                    <h3 class="font-semibold text-lg mb-3 flex items-center">
                                        <i class="fas fa-headset mr-2 text-blue-500"></i>
                                        Support Technique
                                    </h3>
                                    <p class="text-gray-600 mb-4">Pour toute question technique ou problème d'utilisation.</p>
                                    <div class="space-y-3">
                                        <a href="mailto:support@h7social.com" class="flex items-center text-blue-600 hover:text-blue-800 transition-colors">
                                            <i class="fas fa-envelope mr-3 w-5"></i> 
                                            support@h7social.com
                                        </a>
                                        <p class="flex items-center text-gray-600">
                                            <i class="fas fa-clock mr-3 w-5"></i> 
                                            Lun-Ven 9h-18h (GMT+1)
                                        </p>
                                        <p class="flex items-center text-green-600">
                                            <i class="fas fa-phone mr-3 w-5"></i> 
                                            Réponse en moins de 24h
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="bg-white rounded-xl p-6 border border-gray-200">
                                    <h3 class="font-semibold text-lg mb-3 flex items-center">
                                        <i class="fas fa-users mr-2 text-purple-500"></i>
                                        Équipe H7
                                    </h3>
                                    <p class="text-gray-600 mb-4">Pour les partenariats et questions générales.</p>
                                    <div class="space-y-3">
                                        <a href="mailto:contact@h7social.com" class="flex items-center text-blue-600 hover:text-blue-800 transition-colors">
                                            <i class="fas fa-envelope mr-3 w-5"></i> 
                                            contact@h7social.com
                                        </a>
                                        <a href="https://t.snapchat.com/XuhVH62f" target="_blank" rel="noopener noreferrer" class="flex items-center text-yellow-600 hover:text-yellow-800 transition-colors">
                                            <i class="fab fa-snapchat-ghost mr-3 w-5"></i> 
                                            Suivez-nous sur Snapchat
                                        </a>
                                        <p class="flex items-center text-gray-600">
                                            <i class="fas fa-globe mr-3 w-5"></i> 
                                            Disponible 24/7
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Support Premium -->
                            <div class="p-6 gradient-bg rounded-xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold text-lg mb-2 flex items-center">
                                            <i class="fas fa-crown mr-2"></i>
                                            Support Premium
                                        </h4>
                                        <p class="text-sm opacity-90">Réponse garantie en moins de 2h + support prioritaire</p>
                                    </div>
                                    <button onclick="showToast('Fonctionnalité premium à venir!', 'info')" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition-colors">
                                        En savoir plus
                                    </button>
                                </div>
                            </div>
                        </div>
                    `
                }
            };

            const modalData = modals[type] || modals.about;
            title.textContent = modalData.title;
            content.innerHTML = modalData.content;
            modal.classList.remove('hidden');
        };

        window.closeModal = function() {
            document.getElementById('general-modal').classList.add('hidden');
        };

        // Utilitaires
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-start space-x-3">
                    <i class="fas fa-${type === 'success' ? 'check-circle text-green-500' : 
                                     type === 'error' ? 'exclamation-circle text-red-500' : 
                                     'info-circle text-blue-500'} mt-0.5"></i>
                    <div>
                        <p class="font-medium text-gray-900">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // Fonctions pour les messages
        window.downloadAttachment = function(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast(`Téléchargement de ${filename} démarré`, 'success');
        };

        window.editMessage = function(messageId) {
            const message = messages.find(m => m.id === messageId);
            if (!message) return;

            const contentElement = document.getElementById(`message-content-${messageId}`);
            const originalText = message.text;

            // Remplacer le contenu par un input
            contentElement.innerHTML = `
                <div class="flex items-center space-x-2">
                    <input type="text" id="edit-input-${messageId}" value="${originalText}" 
                           class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="saveMessageEdit('${messageId}')" class="text-green-600 hover:text-green-800" title="Sauvegarder">
                        <i class="fas fa-check"></i>
                    </button>
                    <button onclick="cancelMessageEdit('${messageId}', '${originalText}')" class="text-gray-600 hover:text-gray-800" title="Annuler">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.getElementById(`edit-input-${messageId}`).focus();
        };

        window.saveMessageEdit = function(messageId) {
            const newText = document.getElementById(`edit-input-${messageId}`).value.trim();
            if (!newText) {
                showToast('Le message ne peut pas être vide', 'error');
                return;
            }

            const messageIndex = messages.findIndex(m => m.id === messageId);
            if (messageIndex >= 0) {
                messages[messageIndex].text = newText;
                messages[messageIndex].edited = true;
                messages[messageIndex].editedAt = new Date().toISOString();

                // Mettre à jour dans Firebase si connecté
                if (isFirebaseConnected && database) {
                    const messageRef = window.firebaseRefs.ref(database, `messages/${messageId}`);
                    window.firebaseRefs.set(messageRef, messages[messageIndex]);
                }

                updateMessages();
                showToast('Message modifié avec succès', 'success');
            }
        };

        window.cancelMessageEdit = function(messageId, originalText) {
            const contentElement = document.getElementById(`message-content-${messageId}`);
            contentElement.innerHTML = originalText;
        };

        window.deleteMessage = function(messageId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce message ?')) return;

            const messageIndex = messages.findIndex(m => m.id === messageId);
            if (messageIndex >= 0) {
                messages.splice(messageIndex, 1);

                // Supprimer de Firebase si connecté
                if (isFirebaseConnected && database) {
                    const messageRef = window.firebaseRefs.ref(database, `messages/${messageId}`);
                    window.firebaseRefs.set(messageRef, null);
                }

                updateMessages();
                showToast('Message supprimé', 'success');
            }
        };

        // Fonction pour le formulaire de contact
        window.handleContactForm = function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = {
                name: formData.get('name') || event.target.querySelector('input[type="text"]').value,
                email: formData.get('email') || event.target.querySelector('input[type="email"]').value,
                subject: formData.get('subject') || event.target.querySelector('select').value,
                message: formData.get('message') || event.target.querySelector('textarea').value,
                timestamp: new Date().toISOString()
            };

            // Simuler l'envoi du formulaire
            console.log('Données du formulaire de contact:', data);
            
            // Réinitialiser le formulaire
            event.target.reset();
            
            showToast('Votre message a été envoyé avec succès! Nous vous répondrons bientôt.', 'success');
            
            // Fermer la modal après 2 secondes
            setTimeout(() => {
                closeModal();
            }, 2000);
        };

        // Fonction spéciale pour l'admin H7 - Vider tout le chat
        window.adminClearAllMessages = function() {
            if (!currentUser || !currentUser.isAdmin || currentUser.username !== 'H7') {
                showToast('Seul l\'administrateur H7 peut effectuer cette action!', 'error');
                return;
            }

            if (!confirm('⚠️ ATTENTION ⚠️\n\nVous êtes sur le point de supprimer TOUS les messages du chat public.\nCette action est IRRÉVERSIBLE!\n\nÊtes-vous absolument sûr de vouloir continuer?')) {
                return;
            }

            // Double confirmation pour une action aussi critique
            if (!confirm('Dernière confirmation:\n\nTous les messages de tous les utilisateurs seront définitivement supprimés.\n\nConfirmer la suppression complète?')) {
                return;
            }

            // Vider les messages localement
            messages = [];
            
            // Supprimer tous les messages de Firebase si connecté
            if (isFirebaseConnected && database) {
                const messagesRef = window.firebaseRefs.ref(database, 'messages');
                window.firebaseRefs.set(messagesRef, null);
            }

            // Mettre à jour l'interface
            updateMessages();
            
            showToast('🧹 Tous les messages ont été supprimés par l\'administrateur H7', 'success');
            
            console.log(`[ADMIN ACTION] Chat entièrement vidé par ${currentUser.username} à ${new Date().toISOString()}`);
        };

        // Afficher le bouton admin uniquement pour H7
        function updateAdminControls() {
            const adminButton = document.getElementById('admin-clear-chat');
            if (currentUser && currentUser.isAdmin && currentUser.username === 'H7') {
                adminButton.classList.remove('hidden');
            } else {
                adminButton.classList.add('hidden');
            }
        };

        // Fermer les modales avec Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAuthModal();
                closeModal();
            }
        });
    </script>
</body>
</html>